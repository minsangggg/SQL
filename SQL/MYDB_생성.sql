create database my_db;
use my_db;

CREATE TABLE DEPT (
    DEPTNO INT NOT NULL PRIMARY KEY,
    DNAME VARCHAR(14),
    LOC VARCHAR(13)
);

-- 2. EMP 테이블 생성
CREATE TABLE EMP (
    EMPNO INT NOT NULL PRIMARY KEY,
    ENAME VARCHAR(10),
    JOB VARCHAR(9),
    MGR INT,
    HIREDATE DATE,
    SAL DECIMAL(7, 2),
    COMM DECIMAL(7, 2),
    DEPTNO INT,
    FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
);

-- 3. DEPT 테이블 데이터 삽입
INSERT INTO DEPT (DEPTNO, DNAME, LOC) VALUES (10, 'ACCOUNTING', 'NEW YORK');
INSERT INTO DEPT (DEPTNO, DNAME, LOC) VALUES (20, 'RESEARCH', 'DALLAS');
INSERT INTO DEPT (DEPTNO, DNAME, LOC) VALUES (30, 'SALES', 'CHICAGO');
INSERT INTO DEPT (DEPTNO, DNAME, LOC) VALUES (40, 'OPERATIONS', 'BOSTON');

-- 4. EMP 테이블 데이터 삽입
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7839, 'KING', 'PRESIDENT', NULL, '1981-11-17', 5000, NULL, 10);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7566, 'JONES', 'MANAGER', 7839, '1981-04-02', 2975, NULL, 20);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7698, 'BLAKE', 'MANAGER', 7839, '1981-05-01', 2850, NULL, 30);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7782, 'CLARK', 'MANAGER', 7839, '1981-06-09', 2450, NULL, 10);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7902, 'FORD', 'ANALYST', 7566, '1981-12-03', 3000, NULL, 20);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7499, 'ALLEN', 'SALESMAN', 7698, '1981-02-20', 1600, 300, 30);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7521, 'WARD', 'SALESMAN', 7698, '1981-02-22', 1250, 500, 30);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7654, 'MARTIN', 'SALESMAN', 7698, '1981-09-28', 1250, 1400, 30);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7844, 'TURNER', 'SALESMAN', 7698, '1981-09-08', 1500, NULL, 30);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7876, 'ADAMS', 'CLERK', 7788, '1983-01-12', 1100, NULL, 20);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7900, 'JAMES', 'CLERK', 7698, '1981-12-03', 950, NULL, 30);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7934, 'MILLER', 'CLERK', 7782, '1982-01-23', 1300, NULL, 10);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7788, 'SCOTT', 'ANALYST', 7566, '1982-12-09', 3000, NULL, 20);
INSERT INTO EMP (EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO) VALUES (7369, 'SMITH', 'CLERK', 7902, '1980-12-17', 800, NULL, 20);

commit;
select * from EMP;

 
CREATE TABLE salgrade (
    grade INT(2) PRIMARY KEY,
    losal INT(5),
    hisal INT(5)
);
-- 샘플 데이터 삽입
INSERT INTO salgrade (grade, losal, hisal) VALUES (1, 700, 1200);
INSERT INTO salgrade (grade, losal, hisal) VALUES (2, 1201, 1400);
INSERT INTO salgrade (grade, losal, hisal) VALUES (3, 1401, 2000);
INSERT INTO salgrade (grade, losal, hisal) VALUES (4, 2001, 3000);
INSERT INTO salgrade (grade, losal, hisal) VALUES (5, 3001, 9999);

COMMIT;

select * from dept;
-- salgrade-> 컬럼:grade,losal,hisal
-- emp-> 컬럼:empno,ename,job,mgr,hiredate,sal,comm,deptno
-- dept-> 컬럼:deptno,dname,loc
-- employee number, department number
-- 사원들의 소속 부서 종류만 조회
select dname
from dept;

-- 급여가 2000이상 3000이하를 받는 사원 정보(부서번호, 이름, 직무, 급여)만 조회 , 결과집합 생성
select DEPTNO,ename,job,sal 급여
from emp
where SAL between 2000 and 3000;

-- 사원번호가 7902, 7788, 7566인  사원 정보(사원번호,부서번호, 이름, 직무 )만 조회
SELECT EMPNO,DEPTNO,ENAME,JOB
FROM EMP
WHERE EMPNO IN(7902,7788,7566);

-- 사원 이름이 ‘A’로 시작하는  사원이름, 급여, 업무
select ename,sal,job
from emp
where ename like 'A%';

-- 사원 이름의 두번째 문자가 ‘A’인  모든 사원이름, 급여, 업무
select ename,sal,job
from emp
where ename like '_A%';
-- 사원 이름이 마지막 문자가 ‘N’인  사원이름, 급여, 업무 조회
select ename,sal,job
from emp
where ename like '%N';
-- 커미션을 받지 않는 사원이름, 급여, 업무, 커미션을  조회
SELECT ENAME,SAL,JOB,COMM
FROM EMP
WHERE COMM IS NULL;
-- 커미션이 NULL인 경우 0으로바꾸고, SAL+COMM = TOTAL_SALARY 계산
SELECT ENAME,SAL,
IFNULL(COMM,0) AS COMM,
SAL+IFNULL(COMM,0) AS TOTAL_SALARY
FROM EMP;

-- 커미션을 받는 사원들의 커미션 평균
SELECT AVG(COMM) AS 커미션평균
FROM EMP
WHERE COMM IS NOT NULL;

-- DEPTNO, JOB별 급여합계, 급여평균, 총합계
SELECT DEPTNO, JOB, SUM(SAL) AS 급여합계, AVG(SAL) AS 급여평균
FROM EMP
GROUP BY DEPTNO,JOB
WITH ROLLUP;

/*Q1.
“각 부서별 평균 급여(SAL)가 2000 이상인 부서의
부서명(DNAME), 부서평균급여(AVG_SAL)를 조회하시오.
(평균급여는 소수점 2자리까지, 결과는 평균급여 내림차순 정렬)”*/

-- 정답
SELECT D.DNAME, ROUND(AVG(E.SAL), 2) AS AVG_SAL
FROM EMP E   -- EMP를 E라고 부르겠다
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
GROUP BY D.DNAME
HAVING AVG(E.SAL) >= 2000
ORDER BY AVG_SAL DESC;

/*Q2.
‘NEW YORK’에서 근무하는 부서에 소속된 사원 중에서
커미션(COMM)이 NULL이거나 0인 사원만 찾아
사원번호(EMPNO), 이름(ENAME), 직무(JOB), 부서명(DNAME), 근무지(LOC)를 조회하시오.
(결과는 사원번호 오름차순) */

SELECT 
  E.EMPNO, E.ENAME, E.JOB, D.DNAME, D.LOC
FROM 
  EMP E
JOIN 
  DEPT D ON E.DEPTNO = D.DEPTNO
WHERE 
  D.LOC = 'NEW YORK'
  AND (E.COMM IS NULL OR E.COMM = 0)
ORDER BY E.EMPNO ASC;